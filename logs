from gzip import open as gzip_open
from sys import argv
from os.path import exists, join
from logger import Logger

log = Logger()


def main():
    log_file = argv[1]
    archiving_folder = argv[2]

    log.print_info(
        "Verificando a localização do arquivo de log e pasta de arquivamento."
    )
    if not exists(log_file):
        raise Exception("Arquivo de log passado por parâmetro não existe.")
    if not exists(archiving_folder):
        raise Exception("Pasta de arquivamento passado por parâmetro não existe.")

    log.print_info("Comprimindo arquivo de log.")

    with open(log_file, "r") as arq_log_file:

        with gzip_open(join(archiving_folder, "teste.log.gz"), "wb") as arq_gzip:
            arq_gzip.write(arq_log_file.read().encode())

    log.print_info("Arquivo de log comprimido.")


if __name__ == "__main__":
    if len(argv) != 3:
        raise Exception(
            "Utilização: python3 rotacionar_logs.py /var/log/meu_log.log /var/log/arquivamento"
        )
    log.print_info("Iniciando script")
    main()
    log.print_error("Finalizando script")
